<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <title>stock-sonify</title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta name="description" content="An experiment to try and subconsciously 'train' one's brain to learn the trends, movements, and behaviors of particular equities.">
        <meta name="author" content="Dan Simmons, Jeffrey Portman, Karan Daftary">

        <link href="./css/bootstrap.min.css" rel="stylesheet">
        <link href="./css/styles.css" rel="stylesheet">
    </head>

    <body>
        <div class="container">
            <div class="hero-unit">

                <h1>stock-sonify</h1>
                <br />
                <p>An experiment to try and subconsciously 'train' one's brain to learn the trends, movements, and behaviors of particular equities.</p>
                <br />

                <div id="chart"></div>

                <div class="control-group">
                    <div class="controls">
                        <div class="input-append">
                            <input class="input-mini" id="ticker" size="16" type="text" placeholder="Ticker" autofocus="autofocus">
                            <button class="btn" id="download" data-loading-text="Downloading..."><i class="icon-download"></i> Download Data</button>
                            <button class="btn disabled" id="play"><i class="icon-play"></i></button>
                        </div>
                    </div>
                </div>
                <div class="btn-group" data-toggle="buttons-radio" align="center">
                    <button class="btn">5d</button>
                    <button class="btn">1m</button>
                    <button class="btn">3m</button>
                    <button class="btn">6m</button>
                    <button class="btn">YTD</button>
                    <button class="btn" id="default_resolution">1y</button>
                    <button class="btn">5y</button>
                    <button class="btn">10y</button>
                </div>

            </div>

            <hr />
            <footer>
                <p>&copy; 2012 Dan Simmons, Jeffrey Portman, Karan Daftary</p>
            </footer>

        </div>

        <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
        <script src="./js/jquery.xdomainajax.js" type="text/javascript"></script>
        <script src="./js/lib/d3.v2.min.js" type="text/javascript"></script>
        <script src="./js/lib/bootstrap.min.js" type="text/javascript"></script>
        <script src="./js/riffwave.js" type="text/javascript"></script>
        <script src="./js/main.js" type="text/javascript"></script>
        <script type="text/javascript">
            var w = 800;
            var h = 400;

            var chart = d3.select("#chart").append("svg:svg")
            .attr('width', w)
            .attr('height', h);

                $(function() {

                        // Select 1Y resolution by default
                        $(document).ready( function() {
                            $('#default_resolution').button('toggle');
                        });

                        // Map 'space' and/or 'p' to hitting "play"
                        $(document).keypress( function(e) {
                            if (e.keyCode == 112 || e.keyCode == 32) {
                                $('#play').trigger('click');
                            }
                        });

                        // Reset buttons if changing ticker symbol.
                        $('#ticker').focus( function() {
                            $('#download').button('reset');
                            $('#play').addClass('disabled').removeClass('btn-success');
                        });

                        // Allow enter key to simulate clicking "download data" button
                        $('#ticker').keypress( function(e) {
                            if (e.keyCode == 13) {
                                $('#download').trigger('click');
                                $('#play').trigger('focus');
                            }
                        });

                        // Grab ticker data from Yahoo. Do nothing if no symbol is present.
                        // Enable green "play" button on success.
                        $('#download').click( function() {
                            var ticker = $('#ticker').val();
                            if (ticker.length === 0) return;

                            //TODO: allow the changing of resolution
                            $('#download').button('loading');
                            getYahooTimeSeriesData(ticker, 1, function(data) {
                                if (data) {
                                    $('#download').button('reset');
                                    $('#play').removeClass('disabled').addClass('btn-success');
                                    window.chart_data = data;
                                }
                            });
                        })

                        // Render chart by pressing play button.
                        $('#play').click( function() {
                            if ( ! ($('#play').hasClass('disabled')) ) {

                                var x = d3.scale.linear().domain([0, window.chart_data.length]).range([0, w]);
                                var y = d3.scale.linear().domain([0, d3.max(window.chart_data, function(d) {
                                        return d.close;
                                    })]).rangeRound([0, h]);
                                var barWidth = w / window.chart_data.length;


                                chart.selectAll("rect")
                                    .data(window.chart_data)
                                    .enter().append("svg:rect")
                                    .attr("x", function(d, i) { return x(i); })
                                    .attr("y", function(d) { return h - y(d.close) + 15; })
                                    .attr("height", function(d) { return y(d.close); })
                                    .attr("width", barWidth)
                                    .attr("fill", "#ccc");
                            }
                            playReturnSeriesSonification(0.1);
                        });
                });
    </script>

        <script src="./js/dom.js" type="text/javascript"></script>
    </body>
</html>
